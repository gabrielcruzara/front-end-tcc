<app-bread-crumb [items]="[
    { text: 'Serviços', link: '/servicos' },
    { text: 'Iniciar Serviço' }
  ]"></app-bread-crumb>

<section class="container-fluid content">
    <div class="card card-outline card-blue mr-5 ml-5">
        <div class="card-header">
            <h3 class="card-title mb-0">Iniciar Serviço</h3>
        </div>

        <div class="card-body">
            <form [formGroup]="iniciaForm" novalidate>
                <div class="row">
                    <div class="col-md-6" style="margin-left: 10px">
                        <div class="input-group">
                            <select name="" id="servico" class="form-control form-control-sm" formControlName="inicia">
                                <option selected value="">Selecione o Serviço</option>
                                <option *ngFor="let servico of servicos" [value]="servico.identificadorServico">
                                    {{ servico.nomeServico }}
                                </option>
                            </select>
    
                            <button type="button" class="btn btn-success btn-sm" (click)="iniciarServico()">
                                <i class="fas fa-check"></i>
                                <span>Iniciar Serviço</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- <pre> {{ iniciaForm.value | json }}</pre> -->
            </form>

            <hr />

                <ngx-spinner 
                    name="servicos" 
                    bdColor="rgba(0,0,0,0.3)" 
                    size="small" 
                    color="#fff"
                    type="line-scale" 
                    [fullScreen]="false">
                    <p style="color: white">Processando...</p>
                </ngx-spinner>

                <div class="col-md-12">
                    <div class="mat-elevation-z4" [hidden]="!deveExibir">
                        <table 
                            mat-table [dataSource]="dataSource" 
                            class="w-100" 
                            matSort 
                            matSortDisableClear
                            class="mat-elevation-z8" 
                            matSortActive="data" 
                            matSortDirection="asc"
                            [hidden]="semDados">

                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

                            <ng-container matColumnDef="nomeServico">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome do Serviço</th>
                                <td mat-cell *matCellDef="let element">{{ element.nomeServico }}</td>
                            </ng-container>

                            <ng-container matColumnDef="custoServico">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                                <td mat-cell *matCellDef="let element"></td>
                            </ng-container>

                            <ng-container matColumnDef="quantidade">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantidade</th>
                                <td mat-cell *matCellDef="let element"> {{ element.quantidade }}</td>
                            </ng-container>

                            <ng-container matColumnDef="valorCobrado">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                                <td mat-cell *matCellDef="let element"></td>
                            </ng-container>

    
                            <ng-container matColumnDef="horaInicio">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Hora de Inicio</th>
                                <td mat-cell *matCellDef="let element"> {{ element.horaInicio }}</td>
                            </ng-container>

                            <ng-container matColumnDef="observacao">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                                <td mat-cell *matCellDef="let element"></td>
                            </ng-container>

                            <ng-container matColumnDef="idHistoricoServico">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Ação</th>
                                <td mat-cell *matCellDef="let element">
                                    <button 
                                        type="button" 
                                        class="btn btn-info" 
                                        tooltip="Adicionar"
                                        [disabled]="!selectedModel" >
                                        <i class="fas fa-plus"></i>
                                    </button>

                                    <button 
                                        type="button" 
                                        class="btn btn-danger" 
                                        tooltip="Diminuir"
                                        [disabled]="!selectedModel">
                                        <i class="fas fa-minus"></i>
                                    </button>

                                    <button 
                                        type="button" 
                                        class="btn btn-success" 
                                        tooltip="Concluir Serviço"
                                        [disabled]="!selectedModel">
                                    <i class="fas fa-check"></i>
                                </button>
                                </td>
                            </ng-container>

                            <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="selecionar(row)"
                                class="clickable"
                                [ngClass]="{ 'bg-light': selectedModel?.idHistoricoServico === row.idHistoricoServico }">
                            </tr>
                        </table>

                        <h5 [hidden]="!semDados" class="table-no-data">Nenhum serviço selecionado</h5>

                        <mat-paginator [pageSizeOptions]=" [10, 15, 20]" showFirstLastButtons
                            (page)="selectedModel = null">
                        </mat-paginator>
                    </div>
                </div>
        </div>

        <div class="card-footer">
        </div>
    </div>
</section>